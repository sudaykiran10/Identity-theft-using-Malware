from django.http import HttpResponse
from django.shortcuts import render
from django.core.mail import send_mail
import socket
import platform
import psutil
import uuid

def home(request):
    return render(request, 'home.html')

def get_system_info():
    ip_address = socket.gethostbyname(socket.gethostname())
    cpu_info = platform.processor()
    memory_info = str(psutil.virtual_memory())
    mac_address = ':'.join(['{:02x}'.format((uuid.getnode() >> elements) & 0xff) for elements in range(0, 2 * 6, 2)][::-1])
    return {
        'ip_address': ip_address,
        'cpu_info': cpu_info,
        'memory_info': memory_info,
        'mac_address': mac_address,
        'hostname': socket.gethostname()
    }

def send_system_info(request):
    system_info = get_system_info()

    # Prepare email content
    email_content = f"""
    Hostname: {system_info['hostname']}
    IP Address: {system_info['ip_address']}
    MAC Address: {system_info['mac_address']}
    CPU Info: {system_info['cpu_info']}
    Memory Info: {system_info['memory_info']}
    """

    # Send email
    send_mail(
        'System Information',
        email_content,
        'sudaykiran10@gmail.com',  # Sender email address
        ['soujanyarv095@gmail.com'],  # Recipient email address
        fail_silently=False,
    )

    return HttpResponse("System information sent successfully.")
